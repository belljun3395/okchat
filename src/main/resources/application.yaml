spring:
    application:
        name:  ok-chat
    datasource:
        url: jdbc:mysql://localhost:13306/okchat?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul
        driver-class-name: com.mysql.cj.jdbc.Driver
        username: root
        password: root
        hikari:
            maximum-pool-size: 10
            minimum-idle: 2
            connection-timeout: 30000
            idle-timeout: 600000
            max-lifetime: 1800000
    data:
        redis:
            host: localhost
            port: 16379
    cloud:
        task:
            enabled: true  # Set to true to run as task mode
            initialize-enabled: true
            table-prefix: TASK_
            single-instance-enabled: true
    ai:
        retry:
            max-attempts: 5
            backoff:
                initial-interval: 2s
                multiplier: 2
                max-interval: 30s
        vectorstore:
            type: typesense
            typesense:
                collection-name: vector_store
                embedding-dimension: 1536
                client:
                    protocol: http
                    host: localhost
                    port: 8108
                    apiKey: Hu52dwsas2AdxdE
        openai:
            api-key: ${OPENAI_API_KEY}
            embedding:
                model: text-embedding-3-small
            chat:
                options:
                    model: gpt-4.1-mini

confluence:
    base-url: ${CONFLUENCE_BASE_URL}
    auth:
        type: BASIC
        email: ${CONFLUENCE_EMAIL}
        api-token: ${CONFLUENCE_API_TOKEN}

email:
    polling:
        interval: 60000
        initial-delay: 10000
    mail:
        protocol: imaps
        timeout: 10000
        connection-timeout: 10000
        debug: true
        debug-auth: true
        ssl:
            enabled: true
            trust: "*"

    providers:
        gmail:
            type: GMAIL
            host: imap.gmail.com
            port: 993
            username: ${GMAIL_USERNAME}
            auth-type: OAUTH2
            enabled: true
            oauth2:
                client-id: ${GMAIL_CLIENT_ID}
                client-secret: ${GMAIL_CLIENT_SECRET}
                tenant-id: ${GMAIL_TENANT_ID:common}
                scopes:
                    - https://mail.google.com/
                redirect-uri: http://localhost:8080/oauth2/callback

task:
    confluence-sync:
        enabled: false
    email-polling:
        enabled: false

# Hybrid search configuration
search:
    hybrid:
        keyword:
            text-weight: 0.7    # Favor text matching for keywords
            vector-weight: 0.3
        title:
            text-weight: 0.7    # Favor text matching for titles
            vector-weight: 0.3
        content:
            text-weight: 0.4    # Balance text and semantic for content
            vector-weight: 0.6
    fields:
        keyword:
            query-by: "metadata.keywords,metadata.title,content"
            weights: "10,5,1"   # Heavy weight on keywords field
        title:
            query-by: "metadata.title,content"
            weights: "10,1"     # Heavy weight on title field
        content:
            query-by: "metadata.title,content,metadata.keywords"
            weights: "5,3,10"   # Balanced weights

rag:
    confluence:
        chunking:
            strategy: RECURSIVE_CHARACTER  # Options: RECURSIVE_CHARACTER, SEMANTIC, SENTENCE_WINDOW
            chunk-size: 512
            chunk-overlap: 50
            min-chunk-size-chars: 350
            min-chunk-length-to-embed: 5
            max-num-chunks: 10000
            keep-separators: true
            semantic-similarity-threshold: 0.5
            sentence-window-size: 3

    rrf:
        k: 60.0
        keyword-weight: 1.3
        title-weight: 1.5
        content-weight: 0.8